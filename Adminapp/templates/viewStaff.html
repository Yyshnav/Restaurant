{% extends 'sidebar.html' %}
{% load static %}


{% block body %}

    <!-- Custom Switch Style -->
    <style>
      .switch {
        position: relative;
        display: inline-block;
        width: 40px;
        height: 20px;
      }
      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .slider {
        position: absolute;
        cursor: pointer;
        top: 0; left: 0;
        right: 0; bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 34px;
      }
      .slider:before {
        position: absolute;
        content: "";
        height: 14px;
        width: 14px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
      }
      input:checked + .slider {
        background-color: #28c76f;
      }
      input:checked + .slider:before {
        transform: translateX(20px);
      }
    </style>
  


    <!-- Main Content -->
    <div class="app-content content">
      <div class="content-wrapper">
        <div class="content-body">
          <div class="container-fluid">
            <div class="row">
              <div class="col-12">
                <div class="card p-2">

                  <!-- Header Row -->
                  <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-2">
                    <h4 class="card-title mb-2 mb-md-0">View Staffs</h4>
                    <a href="/registerstaff">
                    <button class="btn btn-success btn-sm"><i class="fas fa-user-plus"></i></button></a>
                  </div>

                  <!-- Responsive Table -->
                  <div class="table-responsive">
                    <table class="table table-bordered" id="staffTable">
                      <thead class="thead-dark">
                        <tr>
                          <th>#</th>
                          <th>Name</th>
                          <th>Role</th>
                          <th>Email</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                     <tbody>
                          {% for staff in staffs %}
                          <tr>
                            <td>{{ forloop.counter }}</td>
                            <td>{{ staff.name }}</td>
                            <td>{{ staff.role }}</td>
                            <td>{{ staff.email }}</td>
                            <td>
                              <label class="switch">
                                <input type="checkbox"
                                    {% if staff.userid.is_active %}checked{% endif %}
                                    onchange="toggleStatus(this)"
                                    data-userid="{{ staff.userid.id }}">


                                <span class="slider"></span>
                              </label>
                              <span class="status-label">Active</span>
                            </td>
                            <td>
                                <a href="{% url 'edit_staff' staff.userid.id %}" 
                                  class="btn btn-sm btn-primary" style="color: white;" title="Edit">
                                  <i class="fas fa-edit"></i>
                                </a>
                              <a class="btn btn-sm btn-danger" title="Delete"  href="{% url 'delete_staff' staff.userid.id %}" onclick="return confirm('Are you sure you want to delete this staff?');"><i class="fas fa-trash-alt"></i></a>
                            </td>
                          </tr>
                          {% endfor %}
                        </tbody>

                    </table>
                  </div> 

                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>



    <!-- Custom JS -->
    <script>
        function toggleStatus(checkbox) {
          const userId = checkbox.getAttribute('data-userid');
          const isChecked = checkbox.checked;
          const label = checkbox.closest('td').querySelector('.status-label');
          label.textContent = isChecked ? 'Active' : 'Inactive';

          fetch("/toggle-status/", {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
              "X-CSRFToken": getCookie("csrftoken")
            },
            body: `user_id=${userId}&status=${isChecked}`
          }).then(response => response.json())
            .then(data => {
              if (!data.success) {
                alert("Error: " + data.message);
              }
            })
            .catch(error => console.error("Error:", error));
        }


  // Get CSRF token from cookie
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
      const cookies = document.cookie.split(";");
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        // Does this cookie string begin with the name we want?
        if (cookie.substring(0, name.length + 1) === name + "=") {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
</script>

  

  {% endblock %}