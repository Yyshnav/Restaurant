{% extends 'sidebar.html' %}
{% load static %}


{% block body %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>


    <!-- Main Content -->
    <div class="app-content content">
      <div class="content-wrapper">
        <div class="content-header row">
          <div class="content-header-left col-md-6 col-12 mb-2">
            <h3 class="content-header-title text-dark">Dishes Menu</h3>
          </div>
 <div class="content-header-right col-md-6 col-12">
  <div class="row justify-content-end align-items-center">
    <div class="col-md-6 mb-1 mb-md-0">
      <input type="text" id="dishSearch" class="form-control" placeholder="Search dishes..." autocomplete="off">
        <div id="searchResults" class="bg-white border position-absolute w-100 rounded shadow" style="z-index: 1000; max-height: 300px; overflow-y: auto; display: none;"></div>
    </div>
    <div class="col-md-auto">
      <a href="/add-dish" class="btn btn-primary">
        <i class="ft-plus"></i> Add Dish
      </a>
    </div>
  </div>
</div>


</div>
        <div class="content-body">
          <section id="dishes-list">
            <div class="row match-height">
              
                    {% for entry in items_with_images %}
          <div class="col-lg-4 col-md-6 mb-3">
            <div class="card">
              <div class="card-body">
                <h4 class="card-title">{{ entry.item.name }}</h4>
                <h6 class="card-subtitle text-muted">{{ entry.item.category.name }}</h6>
              </div>

              {% if entry.images %}
              <div id="carousel{{ forloop.counter }}" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                  {% for image in entry.images %}
                  <div class="carousel-item {% if forloop.first %}active{% endif %}">
                    <img src="{{ image.image.url }}" class="d-block w-100" height="300" alt="Dish Image">
                  </div>
                  {% endfor %}
                </div>
                {% if entry.images|length > 1 %}
                <button class="carousel-control-prev" type="button" data-bs-target="#carousel{{ forloop.counter }}" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon"></span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carousel{{ forloop.counter }}" data-bs-slide="next">
                  <span class="carousel-control-next-icon"></span>
                </button>
                {% endif %}
              </div>
              {% endif %}

              <div class="card-body">
                <p class="card-text">{{ entry.item.description }}</p>
              </div>

              <div class="card-footer text-muted">
                â‚¹{{ entry.item.price }}
                <div>
                  <a href="/edit-dish/{{ entry.item.id }}/"><button type="button" class="btn btn-secondary btn-sm">Edit</button></a>
                  <button type="button" onclick="window.location='/delete-dish/{{ entry.item.id }}'" class="btn btn-danger btn-sm">Delete</button>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}


             

            </div>
          </section>
        </div>
      </div>
    </div>

 <script>
document.getElementById('dishSearch').addEventListener('input', function () {
  const query = this.value.trim().toLowerCase();
  const resultsDiv = document.getElementById('searchResults');
  resultsDiv.innerHTML = '';

  const cards = document.querySelectorAll('#dishes-list .card');

  if (query.length === 0) {
    resultsDiv.style.display = 'none';
    cards.forEach(card => {
      card.parentElement.style.display = 'block';
    });
    return;
  }

  fetch(`/search-dishes/?q=${encodeURIComponent(query)}`)
    .then(response => response.json())
    .then(data => {
      if (data.length > 0) {
        resultsDiv.innerHTML = data.map(dish =>
          `<div class="p-2 search-item border-bottom" style="cursor:pointer;" onclick="filterDishCards('${dish.name.toLowerCase()}')">${dish.name}</div>`
        ).join('');
        resultsDiv.style.display = 'block';
      } else {
        resultsDiv.innerHTML = '<div class="p-2 text-muted">No results</div>';
        resultsDiv.style.display = 'block';
      }
    });

  cards.forEach(card => {
    const title = card.querySelector('.card-title').textContent.toLowerCase();
    if (title.includes(query)) {
      card.parentElement.style.display = 'block';
    } else {
      card.parentElement.style.display = 'none';
    }
  });
});

function filterDishCards(name) {
  document.getElementById('dishSearch').value = name;
  document.getElementById('searchResults').style.display = 'none';

  const cards = document.querySelectorAll('#dishes-list .card');
  cards.forEach(card => {
    const title = card.querySelector('.card-title').textContent.toLowerCase();
    if (title.includes(name)) {
      card.parentElement.style.display = 'block';
    } else {
      card.parentElement.style.display = 'none';
    }
  });
}


document.addEventListener('click', function (e) {
  if (!document.getElementById('dishSearch').contains(e.target)) {
    document.getElementById('searchResults').style.display = 'none';
  }
});
</script>



{% endblock %}