{% extends 'sidebar.html' %}
{% load static %}


{% block body %}

  <!-- Main Content -->
  <div class="app-content content">
    <div class="content-wrapper">
      <div class="d-flex justify-content-between align-items-center p-2 text-dark">
        <h2 class="mb-0">Branch Report</h2>
      </div>
      <div class="content-body">

        <!-- Filter Section -->
        <section class="branch-filter py-2">
          <div class="container">
            <div class="row align-items-end">
              <div class="col-md-4">
                <label for="filterDate">Filter by Date</label>
                <input type="date" id="filterDate" class="form-control">
              </div>
              <div class="col-md-4">
                <label for="filterMonth">Filter by Month</label>
                <input type="month" id="filterMonth" class="form-control">
              </div>
              <div class="col-md-4">
                <button id="resetFilters" class="btn btn-secondary mt-2">Reset Filters</button>
              </div>
            </div>
          </div>
        </section>

        <!-- Report Table -->
        <section class="branch-report py-3">
          <div class="container">
            <div class="table-responsive">
              <table class="table table-bordered table-striped">
                <thead class="bg-primary text-white">
                  <tr>
                    <th>#</th>
                    <th>Branch Name</th>
                    <th>Total Sales</th>
                    <th>Customers</th>
                    <th>Employees</th>
                    <th>Last Updated</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>1</td>
                    <td>Main Branch</td>
                    <td>$12,000</td>
                    <td>150</td>
                    <td>12</td>
                    <td>2025-06-29</td>
                  </tr>
                  <tr>
                    <td>2</td>
                    <td>North Branch</td>
                    <td>$8,500</td>
                    <td>120</td>
                    <td>10</td>
                    <td>2025-06-28</td>
                  </tr>
                  <tr>
                    <td>3</td>
                    <td>South Branch</td>
                    <td>$10,000</td>
                    <td>135</td>
                    <td>11</td>
                    <td>2025-05-28</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Chart Section -->
        <section class="chart-report py-3">
          <div class="container">
            <h4 class="text-center">Sales Comparison</h4>
            <canvas id="salesChart" height="100"></canvas>
          </div>
        </section>

      </div>
    </div>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      $('.close-navbar').on('click', function () {
        $('.main-menu').removeClass('menu-expanded').addClass('menu-collapsed');
      });

      // Filter Logic
      const allRows = Array.from(document.querySelectorAll("tbody tr"));
      const filterDate = document.getElementById("filterDate");
      const filterMonth = document.getElementById("filterMonth");
      const resetFilters = document.getElementById("resetFilters");

      function applyFilters() {
        const selectedDate = filterDate.value;
        const selectedMonth = filterMonth.value;

        allRows.forEach(row => {
          const dateText = row.cells[5].textContent.trim();
          let show = true;

          if (selectedDate) {
            show = dateText === selectedDate;
          }

          if (selectedMonth) {
            const rowMonth = dateText.slice(0, 7); // 'YYYY-MM'
            show = show && rowMonth === selectedMonth;
          }

          row.style.display = show ? "" : "none";
        });
      }

      filterDate.addEventListener("change", applyFilters);
      filterMonth.addEventListener("change", applyFilters);
      resetFilters.addEventListener("click", () => {
        filterDate.value = "";
        filterMonth.value = "";
        allRows.forEach(row => row.style.display = "");
      });

      // Chart
      const ctx = document.getElementById('salesChart').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Main Branch', 'North Branch', 'South Branch'],
          datasets: [{
            label: 'Total Sales ($)',
            data: [12000, 8500, 10000],
            backgroundColor: ['#7367F0', '#28C76F', '#EA5455']
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    });
  </script>

{% endblock %}
