<!DOCTYPE html>
<html class="loading" lang="en" data-textdirection="ltr">

<head>
  <meta charset="UTF-8" />
  <title>Category Manager - Chameleon Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css?family=Muli:300,400,600,700|Comfortaa:300,400,700" rel="stylesheet">
  <link rel="stylesheet" href="../../theme-assets/css/vendors.css">
  <link rel="stylesheet" href="../../theme-assets/css/app-lite.css">
  <link rel="stylesheet" href="../../theme-assets/css/core/menu/menu-types/vertical-menu.css">
  <link rel="stylesheet" href="../../theme-assets/css/core/colors/palette-gradient.css">
  <style>
    .preview-img {
      border-radius: 4px;
      width: 40px;
      height: 40px;
      object-fit: cover;
    }
    .accordion-button {
  width: 90%;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

  </style>
</head>

<body class="vertical-layout vertical-menu 2-columns menu-expanded fixed-navbar">

  <!-- Navbar -->
  <nav class="header-navbar navbar-expand-md navbar navbar-with-menu fixed-top navbar-semi-light">
    <div class="navbar-wrapper">
      <div class="navbar-container content">
        <div class="collapse navbar-collapse show" id="navbar-mobile">
          <ul class="nav navbar-nav mr-auto float-left">
            <li class="nav-item d-md-none"><a class="nav-link nav-menu-main menu-toggle" href="#"><i class="ft-menu"></i></a></li>
            <li class="nav-item d-none d-md-block"><a class="nav-link nav-link-expand"><i class="ficon ft-maximize"></i></a></li>
          </ul>
          <ul class="nav navbar-nav float-right">
            <li class="dropdown dropdown-user nav-item">
              <a class="dropdown-toggle nav-link dropdown-user-link" href="#" data-toggle="dropdown">
                <!-- <span class="avatar avatar-online"><img src="../../theme-assets/images/portrait/small/avatar-s-19.png" alt="avatar"><i></i></span> -->
              </a>
              <div class="dropdown-menu dropdown-menu-right">
                <a class="dropdown-item" href="#"><i class="ft-user"></i> Edit Profile</a>
                <a class="dropdown-item" href="#"><i class="ft-power"></i> Logout</a>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <!-- Sidebar -->
  <div class="main-menu menu-fixed menu-light menu-accordion    menu-shadow " data-scroll-to-active="true" data-img="../../theme-assets/images/backgrounds/02.jpg">
      <div class="navbar-header">
        <ul class="nav navbar-nav flex-row">       
          <li class="nav-item mr-auto"><a class="navbar-brand" href="index.html"><img class="brand-logo" alt="Chameleon admin logo" src="../../theme-assets/images/logo/logo.png"/>
              <h3 class="brand-text">Admin</h3></a></li>
          <li class="nav-item d-md-none"><a class="nav-link close-navbar"><i class="ft-x"></i></a></li>
        </ul>
      </div>
      <div class="main-menu-content">
        <ul class="navigation navigation-main" id="main-menu-navigation" data-menu="menu-navigation">
          <li class="nav-item"><a href="index.html"><i class="ft-home"></i><span class="menu-title" data-i18n="">Dashboard</span></a>
          </li>
          
          <li class=" nav-item "><a href="viewStaff.html"><i class="ft-users"></i><span class="menu-title" data-i18n="">staff</span></a>
          </li>
          <li class="nav-item"><a href="dishes.html"><i class="ft-box"></i><span class="menu-title" data-i18n="">Dishes</span></a>
          </li>
          <li class="active"><a href="category.html"><i class="ft-tag"></i><span class="menu-title" data-i18n="">Ctegory</span></a>
          </li>
           <li class=" nav-item"><a href="ViewBranch.html"><i class="ft-map-pin"></i><span class="menu-title" data-i18n="">Branches</span></a>
          </li>
          <li class=" nav-item"><a href="branch-report.html"><i class="ft-layers"></i><span class="menu-title" data-i18n="">Reports</span></a>
          </li>
         
          <li class="nav-item"><a href="offer.html"><i class="ft-award"></i><span class="menu-title"> Offers</span></a></li>
            <li class="nav-item"><a href="carousel.html"><i class="ft-image"></i><span class="menu-title"> Carousel</span></a></li>
        </ul>
      </div><a class="btn btn-danger btn-block btn-glow btn-upgrade-pro mx-1" href="https://themeselection.com/products/chameleon-admin-modern-bootstrap-webapp-dashboard-html-template-ui-kit/" target="_blank">LogOut</a>
      <div class="navigation-background"></div>
    </div>

  <!-- Main Content -->
  <div class="app-content content ">
    <div class="content-wrapper ">
      <div class="content-header row ">
        <div class="content-header-left col-md-6 col-12">
          <h3 class="content-header-title text-dark">Category Manager</h3>
        </div>
      </div>
      <div class="content-body ">
        <div class="container mt-2 ">
          <button class="btn btn-primary mb-4" onclick="openModal('', '')">+ Add Main Category</button>
          <div class="accordion w" id="categoryAccordion"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="categoryModal" tabindex="-1" aria-labelledby="categoryModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <form id="categoryForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="categoryModalLabel">Add Category</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal">   <span aria-hidden="true">&times;</span></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="cid">
          <input type="hidden" id="parentCid">
          <div class="mb-3">
            <label for="cname" class="form-label">Category Name</label>
            <input type="text" class="form-control" id="cname" required>
          </div>
          <div class="mb-3">
            <label for="cimg" class="form-label">Category Image</label>
            <input type="file" class="form-control" id="cimg" accept="image/*">
            <img id="previewImg" class="preview-img mt-2" src="" />
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Save Category</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let categories = [];

    function openModal(parentId = '', parentName = '', edit = false, cat = {}) {
      document.getElementById('cid').value = edit ? cat.id : '';
      document.getElementById('parentCid').value = parentId;
      document.getElementById('cname').value = edit ? cat.name : '';
      document.getElementById('previewImg').src = edit && cat.img ? cat.img : '';
      document.getElementById('cimg').value = '';
      document.getElementById('categoryModalLabel').textContent = edit
        ? `Edit "${cat.name}"`
        : parentId ? `Add Subcategory to "${parentName}"` : 'Add Main Category';

      new bootstrap.Modal(document.getElementById('categoryModal')).show();
    }

    document.getElementById('cimg').addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (evt) {
          document.getElementById('previewImg').src = evt.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    document.getElementById('categoryForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const id = document.getElementById('cid').value || Date.now().toString();
      const parentId = document.getElementById('parentCid').value;
      const name = document.getElementById('cname').value;
      const imgSrc = document.getElementById('previewImg').src || '';

      const existingIndex = categories.findIndex(c => c.id === id);

      if (existingIndex !== -1) {
        categories[existingIndex].name = name;
        categories[existingIndex].img = imgSrc;
      } else {
        categories.push({ id, name, img: imgSrc, parent: parentId || null });
      }

      bootstrap.Modal.getInstance(document.getElementById('categoryModal')).hide();
      renderCategories();
    });

    function renderCategories() {
      const container = document.getElementById('categoryAccordion');
      container.innerHTML = '';

      function createItems(parentId, parentAccordionId) {
        return categories
          .filter(c => c.parent === parentId)
          .map(c => {
            const collapseId = `collapse-${c.id}`;
            const headingId = `heading-${c.id}`;
            const childHtml = createItems(c.id, `accordion-${c.id}`).join('');
            return `
           <div class="accordion-item">
  <h2 class="accordion-header" id="${headingId}">
    <button class="accordion-button collapsed px-3 py-2" type="button"
      data-bs-toggle="collapse" data-bs-target="#${collapseId}"
      aria-expanded="false" aria-controls="${collapseId}">
      
      <div class="d-flex w-100 align-items-center justify-content-between">
        <div class="d-flex align-items-center">
          <img src="${c.img}" class="me-2" style="width: 40px; height: 40px; object-fit: cover; border-radius: 5px;">
          <strong>${c.name}</strong>
        </div>
      </div>
      
    </button>
  </h2>

  <div id="${collapseId}" class="accordion-collapse collapse" data-bs-parent="#${parentAccordionId}">
    <div class="accordion-body">
      ${childHtml.length > 0
        ? `<div class="accordion" id="accordion-${c.id}">${childHtml}</div>`
        : '<small class="text-muted">No subcategories</small>'}

      <div class="mt-2 d-flex gap-1">
        <button class="btn btn-sm btn-success" onclick='openModal("${c.id}", "${c.name}")'>+ Sub</button>
        <button class="btn btn-sm btn-warning" onclick='openModal("${c.parent}", "", true, ${JSON.stringify(c)})'>Edit</button>
        <button class="btn btn-sm btn-danger" onclick='deleteCategory("${c.id}")'>Delete</button>
      </div>
    </div>
  </div>
</div>
`;
          });
      }

      const html = createItems(null, 'categoryAccordion');
      container.innerHTML = html.join('');
    }

    function deleteCategory(id) {
      if (confirm('Are you sure you want to delete this category and all its subcategories?')) {
        function removeRecursive(catId) {
          categories.filter(c => c.parent === catId).forEach(child => removeRecursive(child.id));
          categories = categories.filter(c => c.id !== catId);
        }
        removeRecursive(id);
        renderCategories();
      }
    }
  </script>

</body>

</html>
